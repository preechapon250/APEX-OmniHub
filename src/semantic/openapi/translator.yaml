openapi: 3.1.0
info:
  title: Semantic Translator API
  version: 1.0.0
  description: Universal adapter for canonical event translation with atomic idempotency
  contact:
    name: APEX OmniLink
    url: https://apex-omnilink.com
  license:
    name: Proprietary

servers:
  - url: https://api.apex-omnilink.com
    description: Production API

paths:
  /semantic-translator:
    post:
      summary: Translate event to canonical format
      description: |
        Translates provider-specific event data to standardized CanonicalEvent format
        with atomic idempotency guarantees and locale support.
      operationId: translateEvent
      tags:
        - Translation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TranslationRequest'
            example:
              tenantId: "550e8400-e29b-41d4-a716-446655440000"
              idempotencyKey: "event-12345-abc"
              source: "meta_business"
              locale: "en"
              eventData:
                id: "12345"
                type: "post_viewed"
                timestamp: "2026-01-09T06:00:00Z"
                user_id: "user_123"
                metadata:
                  platform: "facebook"
                  campaign_id: "camp_456"
      responses:
        '200':
          description: Translation successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranslationResponse'
              examples:
                success:
                  summary: Successful translation
                  value:
                    success: true
                    event:
                      eventId: "550e8400-e29b-41d4-a716-446655440001"
                      correlationId: "corr-12345-abc"
                      tenantId: "550e8400-e29b-41d4-a716-446655440000"
                      userId: "user_123"
                      source: "meta_business"
                      provider: "meta_business"
                      externalId: "12345"
                      eventType: "social_post_viewed"
                      timestamp: "2026-01-09T06:00:00.000Z"
                      locale: "en"
                      consentFlags: {}
                      metadata:
                        platform: "facebook"
                        campaign_id: "camp_456"
                      payload:
                        id: "12345"
                        type: "post_viewed"
                        user_id: "user_123"
                    cached: false
                    processingTime: 45
                cached:
                  summary: Cached result returned
                  value:
                    success: true
                    event: {}
                    cached: true
                    processingTime: 5
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too many requests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: JWT Bearer token for authentication

  schemas:
    TranslationRequest:
      type: object
      required:
        - tenantId
        - idempotencyKey
        - source
        - eventData
      properties:
        tenantId:
          type: string
          format: uuid
          description: Tenant UUID for isolation
          example: "550e8400-e29b-41d4-a716-446655440000"
        idempotencyKey:
          type: string
          description: Unique key for idempotent operations
          example: "event-12345-abc"
        source:
          type: string
          description: Data source identifier
          example: "meta_business"
        eventData:
          type: object
          description: Provider-specific event data to translate
          additionalProperties: true
        locale:
          type: string
          enum: [en, es, de, ja, fr, pt, it]
          default: en
          description: Target locale for translation
        metadata:
          type: object
          description: Additional translation metadata
          additionalProperties: true

    TranslationResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether the translation was successful
        event:
          $ref: '#/components/schemas/CanonicalEvent'
        cached:
          type: boolean
          description: Whether result was served from cache
        processingTime:
          type: integer
          description: Processing time in milliseconds
        error:
          type: string
          description: Error message if translation failed

    CanonicalEvent:
      type: object
      required:
        - eventId
        - correlationId
        - tenantId
        - userId
        - source
        - provider
        - externalId
        - eventType
        - timestamp
        - locale
        - consentFlags
        - metadata
        - payload
      properties:
        eventId:
          type: string
          format: uuid
          description: Unique event identifier
        correlationId:
          type: string
          format: uuid
          description: Correlation ID for tracing
        tenantId:
          type: string
          format: uuid
          description: Tenant isolation identifier
        userId:
          type: string
          format: uuid
          description: User isolation identifier
        source:
          type: string
          description: Data source identifier
        provider:
          type: string
          description: Provider name
        externalId:
          type: string
          description: External system identifier
        eventType:
          type: string
          enum:
            - social_post_viewed
            - social_post_saved
            - social_post_shared
            - comment
            - message
            - reaction
            - ad_insight
            - page_insight
            - campaign_performance
            - audience_insight
            - profile_view
            - connection_request
            - follow
            - unfollow
            - content_published
            - content_updated
            - content_deleted
          description: Standardized event type
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
        locale:
          type: string
          enum: [en, es, de, ja, fr, pt, it]
          description: Event locale for internationalization
        consentFlags:
          type: object
          description: User consent flags
          properties:
            analytics:
              type: boolean
            marketing:
              type: boolean
            personalization:
              type: boolean
            third_party_sharing:
              type: boolean
        metadata:
          type: object
          description: Provider-specific metadata
          additionalProperties: true
        payload:
          type: object
          description: Standardized event payload
          additionalProperties: true

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          description: Additional error details
          additionalProperties: true